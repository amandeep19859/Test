<?php

/**
 * UserAuditoriaTable
 *
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class UserAuditoriaTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object UserAuditoriaTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('UserAuditoria');
    }

    public static function puedeAuditarHoy($user)
    {
        $q = self::getInstance()->createQuery('q')
            ->andWhere('DATE(created_at) = CURDATE()')
            ->andWhere('tipo = "auditoria"')
            ->andWhere('sf_guard_user_id = ?', $user->getId());
        return $q->count() < sfConfig::get('app_listaBlanca_auditorias_por_dia', 5) ? true : false;
    }

    public static function puedeComentarHoy($user)
    {
        $q = self::getInstance()->createQuery('q')
            ->andWhere('tipo = "comentario"')
            ->andWhere('DATE(created_at) = CURDATE()')
            ->andWhere('sf_guard_user_id = ?', $user->getId());

        return $q->count() < sfConfig::get('app_listaNegra_comentarios_por_dia', 5) ? true : false;

    }

    public static function addAuditoria($user, $tipo = 'auditoria')
    {
        $obj = new UserAuditoria();
        $obj->setSfGuardUser($user);
        $obj->setTipo($tipo);
        $obj->save();

        return true;
    }

}