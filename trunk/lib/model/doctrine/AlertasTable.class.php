<?php

/**
 * AlertasTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class AlertasTable extends Doctrine_Table {

  /**
   * Returns an instance of this class.
   *
   * @return object AlertasTable
   */
  public static function getInstance() {
    return Doctrine_Core::getTable('Alertas');
  }

  public static function nueva($entity, $type, $message, $options = array()) {
    $alerta = new alertas();
    $alerta->setMessage($message);
    $alerta->setEntity($entity);
    $alerta->setType($type);
    if (isset($options['user_id']))
      $alerta->setUserRelatedId($options['user_id']);
    if (isset($options['url']))
      $alerta->setUrl($options['user_id']);
    $alerta->save();
  }

  /**
   * fetch alert for gift redemption
   * @return Doctrine_Query
   */
  public function getGiftAlerts() {
    //create gift alert query
    $gift_alert_query = Doctrine_Query::create()
            ->from('Alertas a')
            ->where('a.entity = 800')
            ->orderBy('a.created_at DESC');
    return $gift_alert_query;
  }

  /**
   * Delete record from gift redemption alert. method delete records according
   * to given parameter ( id or all records)
   * @param String $record_id
   */
  public function deleteRecordsById($record_id) {
    // create delete query
    $delete_query = Doctrine_Query::create()
            ->delete()
            ->from('Alertas a')
            ->where('a.entity = 800');
    if (strtolower($record_id) != 'all') {
      $delete_query->andWhere('a.id =?', $record_id);
    }
    // execute delete query
    $delete_query->execute();
  }

}