<?php

/**
 * PizarraTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class PizarraTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object PizarraTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('Pizarra');
    }
    
    /**
     * method return blackborad records according user hierarchy and
     * section
     * @param String $rank User Hierarchy
     * @param String $section Action & Module name
     * @return Array
     */
    public function getBlackBoardRecords($rank, $section){
      
      $day = "%," . date('N') ."%";
      $month = "%," . date('n') . "%";
      //create blackboard record query
      $blackboard_record_query = Doctrine_Query::create() 
                                                ->from('Pizarra p')
                                                ->leftJoin('p.PizarraSectionMapping psm')
                                                ->leftJoin('psm.PizarraSection ps')
                                                ->where('ps.short_name =?',$section)
                                                ->andWhere('p.visibilidad <=?', $rank)
                                                ->andWhere('p.desde < "'. date('Y-m-d H:i:s') .'"')
                                                ->andWhere('p.hasta > "'. date('Y-m-d H:i:s') .'"')
                                                ->andWhere('p.days LIKE ?', $day)
                                                ->andWhere('p.months LIKE ?', $month)
                                                ->limit(10);
      
      //get balckborad records
      $blackboard_records = $blackboard_record_query->fetchArray();
      
      return $blackboard_records;
    }
}